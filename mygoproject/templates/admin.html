{{define "content"}}
<style>
    .expired {
        background-color: #ffebee;
        color: #c62828;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
    }
    th, td {
        padding: 10px;
        text-align: left;
    }
    th {
        background-color: #f5f5f5;
    }
    button {
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        margin: 2px;
    }
    button.edit {
        background-color: #28a745;
    }
    button.edit:hover {
        background-color: #218838;
    }
    button:hover {
        background-color: #c82333;
    }
    .edit-form {
        display: none;
        margin-top: 10px;
    }
    .edit-form.active {
        display: block;
    }
    .create-booking-form {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    .create-booking-form h2 {
        margin-top: 0;
        margin-bottom: 15px;
    }
    .form-group {
        margin-bottom: 15px;
    }
    .form-group label {
        display: block;
        margin-bottom: 5px;
    }
    .form-group select,
    .form-group input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .form-group button {
        background-color: #28a745;
        width: 100%;
        padding: 10px;
        margin-top: 10px;
    }
    .status-select {
        padding: 5px;
        border-radius: 4px;
        border: 1px solid #ddd;
    }
    .status-pending {
        color: #856404;
        background-color: #fff3cd;
    }
    .status-confirmed {
        color: #155724;
        background-color: #d4edda;
    }
    .status-cancelled {
        color: #721c24;
        background-color: #f8d7da;
    }
    .status-completed {
        color: #004085;
        background-color: #cce5ff;
    }
</style>

<h1>Админ-панель</h1>

<div class="create-booking-form">
    <h2>Создать новую запись</h2>
    <form method="POST" action="/admin/create-booking">
        <div class="form-group">
            <label for="username">Пользователь:</label>
            <select name="username" id="username" required>
                <option value="">Выберите пользователя</option>
                {{range .Users}}
                    <option value="{{.Username}}">{{.Username}}</option>
                {{end}}
            </select>
        </div>
        <div class="form-group">
            <label for="service_id">Услуга:</label>
            <select name="service_id" id="service_id" required>
                <option value="">Выберите услугу</option>
                {{range .Services}}
                    <option value="{{.ID}}">{{.Name}} - {{.Price}} руб.</option>
                {{end}}
            </select>
        </div>
        <div class="form-group">
            <label for="booking_time">Время записи:</label>
            <input type="datetime-local" name="booking_time" id="booking_time" required>
        </div>
        <button type="submit" class="edit">Создать запись</button>
    </form>
</div>

<h2>Существующие записи</h2>
<table>
    <tr>
        <th>Пользователь</th>
        <th>Услуга</th>
        <th>Время записи</th>
        <th>Статус</th>
        <th>Действия</th>
    </tr>
    {{range .Bookings}}
    <tr {{if .IsExpired}}class="expired"{{end}}>
        <td>{{.Username}}</td>
        <td>{{.Service.Name}}</td>
        <td>
            <div class="booking-time">{{.BookingTime}}</div>
            <div class="edit-form" id="edit-form-{{.ID}}">
                <form method="POST" action="/admin/edit-booking" class="edit-booking-form">
                    <input type="hidden" name="booking_id" value="{{.ID}}">
                    <input type="datetime-local" name="new_booking_time" value="{{.BookingTime}}" required>
                    <button type="submit" class="edit">Сохранить</button>
                    <button type="button" onclick="toggleEditForm({{.ID}})" class="edit">Отмена</button>
                </form>
            </div>
        </td>
        <td>
            <form method="POST" action="/admin/update-status" class="status-form">
                <input type="hidden" name="booking_id" value="{{.ID}}">
                <select name="status" class="status-select status-{{.Status}}" onchange="this.form.submit()">
                    <option value="pending" {{if eq .Status "pending"}}selected{{end}}>Ожидает</option>
                    <option value="confirmed" {{if eq .Status "confirmed"}}selected{{end}}>Подтверждено</option>
                    <option value="cancelled" {{if eq .Status "cancelled"}}selected{{end}}>Отменено</option>
                    <option value="completed" {{if eq .Status "completed"}}selected{{end}}>Завершено</option>
                </select>
            </form>
        </td>
        <td>
            <button onclick="toggleEditForm({{.ID}})" class="edit">Изменить время</button>
            <form method="POST" action="/delete-booking" style="display:inline;">
                <input type="hidden" name="booking_id" value="{{.ID}}">
                <button type="submit">Удалить</button>
            </form>
        </td>
    </tr>
    {{end}}
</table>

<script>
function toggleEditForm(bookingId) {
    const form = document.getElementById(`edit-form-${bookingId}`);
    form.classList.toggle('active');
}

// Обновляем стили статуса при изменении
document.querySelectorAll('.status-select').forEach(select => {
    select.addEventListener('change', function() {
        this.className = `status-select status-${this.value}`;
    });
});
</script>

<p><a href="/">На главную</a></p>
<p><a href="/logout">Выйти</a></p>
{{end}} 